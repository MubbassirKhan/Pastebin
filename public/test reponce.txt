E:\projects\mubbu\Pastebin>npm test 

> pastebin-lite@1.0.0 test
> jest

TAP version 13
# Subtest: GET /api/pastes/:id
    # Subtest: Successful retrieval
    ok 1 - Successful retrieval
      ---
      duration_ms: 2.9376
      type: 'suite'
      ...
TAP version 13
    # Subtest: Paste with constraints
    ok 2 - Paste with constraints
      ---
      duration_ms: 363.336
      type: 'suite'
      ...
    # Subtest: Unavailable pastes
    ok 3 - Unavailable pastes
      ---
      duration_ms: 0.6118
      type: 'suite'
      ...
    # Subtest: No negative remaining_views
    ok 4 - No negative remaining_views
      ---
      duration_ms: 0.7209
      type: 'suite'
      ...
    1..4
ok 1 - GET /api/pastes/:id
  ---
  duration_ms: 372.9399
  type: 'suite'
  ...
# Subtest: GET /p/:id (HTML View)
    # Subtest: Successful HTML rendering
    ok 1 - Successful HTML rendering
      ---
      duration_ms: 3.9695
      type: 'suite'
      ...
    # Subtest: HTML view for unavailable pastes
    ok 2 - HTML view for unavailable pastes
      ---
      duration_ms: 12.7245
      type: 'suite'
      ...
    # Subtest: HTML view does NOT count as a view
    ok 3 - HTML view does NOT count as a view
      ---
      duration_ms: 1.2759
      type: 'suite'
      ...
    # Subtest: HTML structure
    ok 4 - HTML structure
      ---
      duration_ms: 1.7642
      type: 'suite'
      ...
    1..4
ok 1 - GET /p/:id (HTML View)
  ---
  duration_ms: 24.665
  type: 'suite'
  ...
TAP version 13
# Subtest: Robustness Tests
    # Subtest: Concurrent access
    ok 1 - Concurrent access
      ---
      duration_ms: 17.2503
      type: 'suite'
      ...
    # Subtest: Error responses consistency
    ok 2 - Error responses consistency
      ---
      duration_ms: 37.5108
      type: 'suite'
      ...
    # Subtest: Large content handling
    ok 3 - Large content handling
      ---
      duration_ms: 10.3059
      type: 'suite'
      ...
    # Subtest: Special characters in content
    ok 4 - Special characters in content
      ---
      duration_ms: 3.0862
      type: 'suite'
      ...
    # Subtest: Response timeout
    ok 5 - Response timeout
      ---
      duration_ms: 1.6887
      type: 'suite'
      ...
    # Subtest: ID format validation
    ok 6 - ID format validation
      ---
      duration_ms: 323.7919
      type: 'suite'
      ...
    1..6
ok 1 - Robustness Tests
  ---
  duration_ms: 415.9026
  type: 'suite'
  ...
 FAIL  __tests__/integration/html-view.test.ts (21.585 s)
  ● should return HTML for an existing paste
                                                                             
    thrown: "Exceeded timeout of 5000 ms for a test.                         
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."        
                                                                             
      11 |                                                                   
      12 |   describe('Successful HTML rendering', () => {                   
    > 13 |     it('should return HTML for an existing paste', async () => {  
         |     ^
      14 |       // Create a test paste
      15 |       const createResponse = await fetch(`${BASE_URL}/api/pastes`, {
      16 |         method: 'POST',

      at SuiteContext.it (__tests__/integration/html-view.test.ts:13:5)      
      at SuiteContext.<anonymous> (__tests__/integration/html-view.test.ts:12:11)
      at Object.<anonymous> (__tests__/integration/html-view.test.ts:9:9)    

  ● should return 404 for expired paste

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 200

      106 |       })
      107 |       
    > 108 |       expect(response.status).toBe(404)
          |                               ^
      109 |     })
      110 |
      111 |     it('should return 404 when view limit exceeded', async () => {

      at Object.toBe (__tests__/integration/html-view.test.ts:108:31)        

# Subtest: Combined Constraints Tests
    # Subtest: TTL expires first
    ok 1 - TTL expires first
      ---
      duration_ms: 2.456
      type: 'suite'
      ...
    # Subtest: View limit reached first
    ok 2 - View limit reached first
      ---
      duration_ms: 2.3855
      type: 'suite'
      ...
    # Subtest: Simultaneous constraints
    ok 3 - Simultaneous constraints
      ---
      duration_ms: 10.8886
      type: 'suite'
      ...
    # Subtest: Edge cases
    ok 4 - Edge cases
      ---
      duration_ms: 1.8937
      type: 'suite'
      ...
    1..4
ok 2 - Combined Constraints Tests
  ---
  duration_ms: 21.6087
  type: 'suite'
  ...
 FAIL  __tests__/api/pastes-fetch.test.ts (22.904 s)
  ● should return ISO timestamp for expires_at when TTL is set
                                                                             
    expect(received).toBe(expected) // Object.is equality                    
                                                                             
    Expected: "2026-01-31T09:34:17.54+00:00"                                 
    Received: "2026-01-31T09:34:17.540Z"                                     
                                                                             
      109 |       // Validate ISO 8601 format                                
      110 |       const date = new Date(data.expires_at)                     
    > 111 |       expect(date.toISOString()).toBe(data.expires_at)
          |                                  ^
      112 |     })
      113 |
      114 |     it('should count API fetches as views', async () => {        

      at Object.toBe (__tests__/api/pastes-fetch.test.ts:111:34)

# Subtest: View Limit Tests
    # Subtest: max_views = 1
    ok 1 - max_views = 1
      ---
      duration_ms: 1.956
      type: 'suite'
      ...
    # Subtest: max_views = 2
    ok 2 - max_views = 2
      ---
      duration_ms: 5.2812
      type: 'suite'
      ...
    # Subtest: max_views = 5
    ok 3 - max_views = 5
      ---
      duration_ms: 2.2273
      type: 'suite'
      ...
    # Subtest: Unlimited views
    ok 4 - Unlimited views
      ---
      duration_ms: 1.9562
      type: 'suite'
      ...
    1..4
ok 2 - View Limit Tests
  ---
  duration_ms: 24.218
  type: 'suite'
  ...
 FAIL  __tests__/integration/robustness.test.ts (23.946 s)
  ● should handle concurrent fetches without negative remaining_views
                                                                             
    thrown: "Exceeded timeout of 5000 ms for a test.                         
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."        
                                                                             
      11 |                                                                   
      12 |   describe('Concurrent access', () => {                           
    > 13 |     it('should handle concurrent fetches without negative remaining_views', async () => {
         |     ^
      14 |       // Create paste with limited views
      15 |       const createResponse = await fetch(`${BASE_URL}/api/pastes`, {
      16 |         method: 'POST',

      at SuiteContext.it (__tests__/integration/robustness.test.ts:13:5)     
      at SuiteContext.<anonymous> (__tests__/integration/robustness.test.ts:12:11)
      at Object.<anonymous> (__tests__/integration/robustness.test.ts:9:9)   

  ● should not serve paste beyond view constraint under concurrent load      

    expect(received).toBeLessThanOrEqual(expected)

    Expected: <= 1
    Received:    3

      63 |
      64 |       // Only 1 should succeed
    > 65 |       expect(successResponses.length).toBeLessThanOrEqual(1)      
         |                                       ^
      66 |     })
      67 |   })
      68 |

      at Object.toBeLessThanOrEqual (__tests__/integration/robustness.test.ts:65:39)

# Subtest: TTL Expiry Tests
    # Subtest: Paste with TTL
    ok 1 - Paste with TTL
      ---
      duration_ms: 9.2101
      type: 'suite'
      ...
    # Subtest: Paste without TTL
    ok 2 - Paste without TTL
      ---
      duration_ms: 1.0585
      type: 'suite'
      ...
    # Subtest: Various TTL values
    ok 3 - Various TTL values
      ---
      duration_ms: 1.0554
      type: 'suite'
      ...
    1..3
ok 2 - TTL Expiry Tests
  ---
  duration_ms: 52.557
  type: 'suite'
  ...
 PASS  __tests__/integration/combined-constraints.test.ts (7.134 s)
# Subtest: POST /api/pastes
    # Subtest: Successful paste creation
    ok 1 - Successful paste creation
      ---
      duration_ms: 0.7238
      type: 'suite'
      ...
    # Subtest: Input validation
    ok 2 - Input validation
      ---
      duration_ms: 1.0576
      type: 'suite'
      ...
    1..2
ok 3 - POST /api/pastes
  ---
  duration_ms: 8.1746
  type: 'suite'
  ...
 PASS  __tests__/integration/ttl-expiry.test.ts (9.387 s)
# Subtest: /api/healthz
ok 3 - /api/healthz
  ---
  duration_ms: 7.7223
  type: 'suite'
  ...
 FAIL  __tests__/integration/view-limits.test.ts (13.145 s)
  ● should allow multiple fetches when no max_views is set

    thrown: "Exceeded timeout of 5000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."        

       98 |
       99 |   describe('Unlimited views', () => {
    > 100 |     it('should allow multiple fetches when no max_views is set', async () => {
          |     ^
      101 |       // Create paste without max_views
      102 |       const createResponse = await fetch(`${BASE_URL}/api/pastes`, {
      103 |         method: 'POST',

      at SuiteContext.it (__tests__/integration/view-limits.test.ts:100:5)   
      at SuiteContext.<anonymous> (__tests__/integration/view-limits.test.ts:99:11)
      at Object.<anonymous> (__tests__/integration/view-limits.test.ts:9:9)  

 PASS  __tests__/api/healthz.test.ts
 PASS  __tests__/api/pastes-create.test.ts (9.716 s)
1..3
# tests 0
# suites 13
# pass 0
# fail 0
# cancelled 0
# skipped 0
# todo 0
# duration_ms 35598.5777
1..3
# tests 0
# suites 12
# pass 0
# fail 0
# cancelled 0
# skipped 0
# todo 0
# duration_ms 35116.8475
1..2
# tests 0
# suites 10
# pass 0
# fail 0
# cancelled 0
# skipped 0
# todo 0
# duration_ms 35573.9897

Test Suites: 4 failed, 4 passed, 8 total
Tests:       6 failed, 53 passed, 59 total
Snapshots:   0 total
Time:        46.039 s
Ran all test suites.

E:\projects\mubbu\Pastebin>